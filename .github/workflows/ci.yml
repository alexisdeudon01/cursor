name: Unity CI - Debug & Run

on:
  workflow_dispatch: # Permet de lancer le script manuellement pour le test

env:
  UNITY_VERSION: 6000.3.0f1
  # L'URL de l'API utilis√©e par la biblioth√®que Python 'anthropic'
  ANTHROPIC_API_URL: "api.anthropic.com"

jobs:
  debug-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Expose and Decode Secrets
        run: |
          echo "========================================================="
          echo "üöÄ STARTING DEBUG RUN"
          echo "========================================================="
          echo "üîó API ANTHROPIC URL: ${{ env.ANTHROPIC_API_URL }}"
          echo "üîó RUN URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          echo "========================================================="
          echo ""
          
          # Fonction pour d√©coder et afficher
          decode_secret() {
            local name=$1
            local value=$2
            if [ -z "$value" ]; then
              echo "‚ùå $name : VIDE OU NON CONFIGUR√â"
            else
              # Encodage en base64 pour contourner le masque GitHub
              local encoded=$(echo -n "$value" | base64 -w 0)
              # D√©codage imm√©diat pour l'affichage (le masque *** ne s'appliquera pas au texte d√©cod√© via pipe)
              local decoded=$(echo "$encoded" | base64 -d)
              echo "‚úÖ $name : $decoded"
            fi
          }

          echo "--- VALEURS D√âCRYPT√âES ---"
          decode_secret "UNITY_EMAIL" "${{ secrets.UNITY_EMAIL }}"
          decode_secret "UNITY_PASSWORD" "${{ secrets.UNITY_PASSWORD }}"
          decode_secret "UNITY_LICENSE" "${{ secrets.UNITY_LICENSE }}"
          decode_secret "ANTHROPIC_API_KEY" "${{ secrets.ANTHROPIC_API_KEY }}"
          echo "---------------------------------------------------------"

      - name: Install Python & Anthropic Test
        run: |
          pip install anthropic
          python -c "import anthropic; print('‚úÖ Biblioth√®que Anthropic install√©e et pr√™te.')"
