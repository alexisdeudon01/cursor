---
title: Session Join - Sequence Diagram
---
sequenceDiagram
    autonumber
    
    participant C as ðŸ–¥ï¸ Client
    participant UI as SessionLobbyUI
    participant RPC as SessionRpcHub
    participant GSM as GameSessionManager
    participant SCM as SessionContainerManager
    participant SC as SessionContainer
    participant GIM as GameInstanceManager
    
    Note over C,GIM: Phase 1: Connexion et CrÃ©ation Session
    
    C->>UI: Clic "CrÃ©er Partie"
    UI->>RPC: RequestCreateSessionServerRpc(gameId, sessionName)
    RPC->>GSM: CreateSession(gameId, sessionName)
    GSM->>SCM: CreateSession(sessionId, hostClientId)
    SCM->>SC: new SessionContainer(sessionId)
    SC-->>SC: Initialize()
    SC->>SC: AuthorizeClient(hostClientId)
    SC-->>SCM: container
    SCM-->>GSM: sessionId
    GSM->>GIM: CreateInstance(gameId)
    GSM-->>RPC: success
    RPC-->>C: SessionCreatedClientRpc(sessionId)
    
    Note over C,GIM: Phase 2: Un autre client rejoint
    
    participant C2 as ðŸ–¥ï¸ Client 2
    
    C2->>RPC: RequestJoinSessionServerRpc(sessionId)
    RPC->>GSM: JoinSession(sessionId, clientId)
    GSM->>SCM: GetSession(sessionId)
    SCM-->>GSM: container
    GSM->>SC: ValidateAccess(clientId)
    SC-->>GSM: false (pas encore autorisÃ©)
    GSM->>SC: AuthorizeClient(clientId)
    SC->>SC: AddPlayer(clientId, playerName)
    SC-->>GSM: success
    GSM-->>RPC: joinSuccess
    RPC-->>C2: JoinSessionResultClientRpc(true)
    RPC-->>C: PlayerJoinedClientRpc(playerName)
    
    Note over C,GIM: Phase 3: Lancement du jeu
    
    C->>RPC: RequestStartGameServerRpc(sessionId)
    RPC->>GSM: StartGame(sessionId, clientId)
    GSM->>SCM: GetAuthorizedSession(sessionId, clientId)
    SCM->>SC: ValidateAccess(clientId)
    SC-->>SCM: true
    SCM-->>GSM: container
    GSM->>SC: IsHost(clientId)?
    SC-->>GSM: true
    GSM->>SC: SetState(SessionState.Starting)
    GSM->>GIM: StartGame(sessionId)
    GIM->>SC: GetPlayers()
    SC-->>GIM: playerList
    
    loop Pour chaque joueur
        GIM->>GIM: SpawnPawn(player, offset)
        GIM->>SC: RegisterPawn(clientId, pawn)
    end
    
    GSM->>SC: SetState(SessionState.InGame)
    RPC-->>C: GameStartedClientRpc()
    RPC-->>C2: GameStartedClientRpc()
    
    Note over C,GIM: Phase 4: Violation de sÃ©curitÃ© (tentative)
    
    participant C3 as âš ï¸ Attaquant
    
    C3->>RPC: RequestJoinSessionServerRpc(otherSessionId)
    RPC->>GSM: JoinSession(otherSessionId, attackerId)
    GSM->>SCM: GetAuthorizedSession(otherSessionId, attackerId)
    SCM->>SC: ValidateAccess(attackerId)
    SC-->>SCM: false
    SCM-->>SCM: OnSecurityViolation.Invoke()
    SCM-->>GSM: null
    GSM-->>RPC: accessDenied
    RPC-->>C3: JoinSessionResultClientRpc(false, "Not authorized")